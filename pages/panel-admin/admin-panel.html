<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - E-S COMPANY</title>
    <link rel="icon" type="image/png" href="https://i.postimg.cc/44F5BnV2/file-000000001f3471fda269be0d033dc40a.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .admin-container {
            display: flex;
            min-height: 100vh;
        }
        
        .admin-sidebar {
            width: 250px;
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
        }
        
        .admin-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }
        
        .admin-logo img {
            height: 30px;
        }
        
        .admin-logo h2 {
            font-size: 1.3rem;
        }
        
        .admin-menu {
            list-style: none;
        }
        
        .admin-menu li {
            margin-bottom: 5px;
        }
        
        .admin-menu a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px 20px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
        }
        
        .admin-menu a:hover,
        .admin-menu a.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .admin-menu i {
            width: 20px;
            text-align: center;
        }
        
        .admin-content {
            flex: 1;
            padding: 20px;
            background-color: #f5f7ff;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .admin-header h1 {
            color: var(--primary-color);
        }
        
        .admin-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .admin-card {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .admin-card h3 {
            color: var(--gray-color);
            font-size: 1rem;
            margin-bottom: 10px;
        }
        
        .admin-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .admin-table {
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .table-header h3 {
            color: var(--primary-color);
        }
        
        .add-product-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }
        
        .add-product-btn:hover {
            background-color: var(--secondary-color);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 15px 20px;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        td img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 4px;
        }
        
        .actions {
            display: flex;
            gap: 10px;
        }
        
        .edit-btn, .delete-btn {
            padding: 5px 10px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .edit-btn {
            background-color: #e7f4ff;
            color: var(--secondary-color);
        }
        
        .edit-btn:hover {
            background-color: #d0e8ff;
        }
        
        .delete-btn {
            background-color: #ffeaea;
            color: #e74c3c;
        }
        
        .delete-btn:hover {
            background-color: #ffd5d5;
        }
        
        .product-form {
            background-color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }
        
        .cancel-btn {
            background-color: var(--light-gray);
            color: var(--dark-color);
            border: none;
            padding: 12px 25px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }
        
        .cancel-btn:hover {
            background-color: #e2e6ea;
        }
        
        .admin-login {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f7ff 0%, #f0f2ff 100%);
        }
        
        .login-box {
            background-color: white;
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 100%;
            max-width: 400px;
        }
        
        .login-box h2 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .admin-container {
                flex-direction: column;
            }
            
            .admin-sidebar {
                width: 100%;
                padding: 10px 0;
            }
            
            .admin-menu {
                display: flex;
                overflow-x: auto;
            }
            
            .admin-menu li {
                flex-shrink: 0;
            }
            
            .admin-menu a {
                padding: 10px 15px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            th, td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Page de connexion admin (à afficher par défaut) -->
    <div id="loginPage" class="admin-login">
        <div class="login-box">
            <div class="admin-logo" style="justify-content: center; border: none; margin-bottom: 30px;">
                <img src="https://i.postimg.cc/44F5BnV2/file-000000001f3471fda269be0d033dc40a.png" alt="E-S COMPANY Logo">
                <h2>E-S COMPANY</h2>
            </div>
            
            <h2>Connexion Admin</h2>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Nom d'utilisateur</label>
                    <input type="text" id="username" placeholder="admin" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Mot de passe</label>
                    <input type="password" id="password" placeholder="••••••••" required>
                </div>
                
                <button type="submit" class="btn" style="width: 100%;">Se connecter</button>
            </form>
            
            <p style="text-align: center; margin-top: 20px; color: var(--gray-color); font-size: 0.9rem;">
                Panel admin pour E-S COMPANY<br>
                <a href="index.html" style="color: var(--primary-color);">Retour au site</a>
            </p>
        </div>
    </div>
    
    <!-- Panel admin (caché par défaut) -->
    <div id="adminPanel" class="admin-container" style="display: none;">
        <!-- Sidebar -->
        <div class="admin-sidebar">
            <div class="admin-logo">
                <img src="https://i.postimg.cc/44F5BnV2/file-000000001f3471fda269be0d033dc40a.png" alt="E-S COMPANY Logo">
                <h2>E-S COMPANY</h2>
            </div>
            
            <ul class="admin-menu">
                <li><a href="#" class="active" data-page="dashboard"><i class="fas fa-tachometer-alt"></i> Tableau de bord</a></li>
                <li><a href="#" data-page="products"><i class="fas fa-box"></i> Produits</a></li>
                <li><a href="#" data-page="categories"><i class="fas fa-tags"></i> Catégories</a></li>
                <li><a href="#" data-page="orders"><i class="fas fa-shopping-cart"></i> Commandes</a></li>
                <li><a href="#" data-page="settings"><i class="fas fa-cog"></i> Paramètres</a></li>
                <li><a href="index.html"><i class="fas fa-store"></i> Voir le site</a></li>
                <li><a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Déconnexion</a></li>
            </ul>
        </div>
        
        <!-- Contenu principal -->
        <div class="admin-content">
            <!-- Dashboard -->
            <div id="dashboardPage" class="admin-page">
                <div class="admin-header">
                    <h1>Tableau de bord</h1>
                    <div class="admin-date">Aujourd'hui: <span id="currentDate"></span></div>
                </div>
                
                <div class="admin-cards">
                    <div class="admin-card">
                        <h3>Produits totaux</h3>
                        <div class="value" id="totalProducts">0</div>
                    </div>
                    
                    <div class="admin-card">
                        <h3>Commandes aujourd'hui</h3>
                        <div class="value" id="todayOrders">0</div>
                    </div>
                    
                    <div class="admin-card">
                        <h3>Revenus totaux</h3>
                        <div class="value" id="totalRevenue">0 HTG</div>
                    </div>
                    
                    <div class="admin-card">
                        <h3>Utilisateurs</h3>
                        <div class="value" id="totalUsers">0</div>
                    </div>
                </div>
                
                <div class="admin-table">
                    <div class="table-header">
                        <h3>Produits récents</h3>
                        <button class="add-product-btn" data-page="products">
                            <i class="fas fa-plus"></i> Ajouter un produit
                        </button>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Nom</th>
                                <th>Catégorie</th>
                                <th>Prix</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recentProductsTable">
                            <!-- Les produits récents seront chargés ici -->
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 30px; color: var(--gray-color);">
                                    Chargement des produits...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Produits -->
            <div id="productsPage" class="admin-page" style="display: none;">
                <div class="admin-header">
                    <h1>Gestion des produits</h1>
                </div>
                
                <div class="admin-table">
                    <div class="table-header">
                        <h3>Tous les produits</h3>
                        <button class="add-product-btn" id="showAddProductForm">
                            <i class="fas fa-plus"></i> Ajouter un produit
                        </button>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Nom</th>
                                <th>Catégorie</th>
                                <th>Prix</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="allProductsTable">
                            <!-- Tous les produits seront chargés ici -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Formulaire d'ajout/modification de produit -->
            <div id="productFormPage" class="admin-page" style="display: none;">
                <div class="admin-header">
                    <h1 id="productFormTitle">Ajouter un produit</h1>
                    <button class="cancel-btn" id="cancelProductForm">
                        <i class="fas fa-arrow-left"></i> Retour
                    </button>
                </div>
                
                <div class="product-form">
                    <form id="productForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="productName">Nom du produit *</label>
                                <input type="text" id="productName" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="productCategory">Catégorie *</label>
                                <select id="productCategory" required>
                                    <option value="">Sélectionner une catégorie</option>
                                    <option value="Vêtements">Vêtements</option>
                                    <option value="Chaussures">Chaussures</option>
                                    <option value="Bijoux">Bijoux</option>
                                    <option value="Accessoires">Accessoires</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="productDescription">Description</label>
                            <textarea id="productDescription" rows="3"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="productPrice">Prix (HTG) *</label>
                                <input type="number" id="productPrice" min="0" step="100" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="productStock">Stock</label>
                                <input type="number" id="productStock" min="0" value="10">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="productImage">URL de l'image *</label>
                            <input type="url" id="productImage" placeholder="https://example.com/image.jpg" required>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="cancel-btn" id="cancelForm">Annuler</button>
                            <button type="submit" class="btn" id="submitProductForm">Enregistrer</button>
                        </div>
                        
                        <input type="hidden" id="productId">
                    </form>
                </div>
            </div>
            
            <!-- Catégories -->
            <div id="categoriesPage" class="admin-page" style="display: none;">
                <div class="admin-header">
                    <h1>Gestion des catégories</h1>
                    <button class="add-product-btn">
                        <i class="fas fa-plus"></i> Ajouter une catégorie
                    </button>
                </div>
                
                <div class="admin-cards">
                    <div class="admin-card" style="text-align: center;">
                        <h3>Vêtements</h3>
                        <div class="value" id="clothesCount">0</div>
                        <p style="color: var(--gray-color); margin-top: 10px;">produits</p>
                    </div>
                    
                    <div class="admin-card" style="text-align: center;">
                        <h3>Chaussures</h3>
                        <div class="value" id="shoesCount">0</div>
                        <p style="color: var(--gray-color); margin-top: 10px;">produits</p>
                    </div>
                    
                    <div class="admin-card" style="text-align: center;">
                        <h3>Bijoux</h3>
                        <div class="value" id="jewelryCount">0</div>
                        <p style="color: var(--gray-color); margin-top: 10px;">produits</p>
                    </div>
                    
                    <div class="admin-card" style="text-align: center;">
                        <h3>Accessoires</h3>
                        <div class="value" id="accessoriesCount">0</div>
                        <p style="color: var(--gray-color); margin-top: 10px;">produits</p>
                    </div>
                </div>
            </div>
            
            <!-- Commandes -->
            <div id="ordersPage" class="admin-page" style="display: none;">
                <div class="admin-header">
                    <h1>Gestion des commandes</h1>
                </div>
                
                <div class="admin-table">
                    <div class="table-header">
                        <h3>Commandes récentes</h3>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>ID Commande</th>
                                <th>Client</th>
                                <th>Date</th>
                                <th>Montant</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 30px; color: var(--gray-color);">
                                    Aucune commande pour le moment. Les commandes apparaîtront ici lorsque les clients passeront des commandes sur le site.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Paramètres -->
            <div id="settingsPage" class="admin-page" style="display: none;">
                <div class="admin-header">
                    <h1>Paramètres du site</h1>
                </div>
                
                <div class="product-form">
                    <form id="settingsForm">
                        <div class="form-group">
                            <label for="siteName">Nom du site</label>
                            <input type="text" id="siteName" value="E-S COMPANY">
                        </div>
                        
                        <div class="form-group">
                            <label for="siteEmail">Email de contact</label>
                            <input type="email" id="siteEmail" value="contact@escompany.com">
                        </div>
                        
                        <div class="form-group">
                            <label for="sitePhone">Téléphone</label>
                            <input type="text" id="sitePhone" value="+509 48 00 0000">
                        </div>
                        
                        <div class="form-group">
                            <label for="siteAddress">Adresse</label>
                            <input type="text" id="siteAddress" value="Port-au-Prince, Haïti">
                        </div>
                        
                        <div class="form-group">
                            <label for="siteDescription">Description du site</label>
                            <textarea id="siteDescription" rows="3">Votre boutique en ligne de mode et d'élégance</textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn">Enregistrer les paramètres</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // État de l'application admin
        let adminProducts = [];
        let editingProductId = null;
        
        // Pages admin
        const loginPage = document.getElementById('loginPage');
        const adminPanel = document.getElementById('adminPanel');
        const adminPages = document.querySelectorAll('.admin-page');
        
        // Éléments du formulaire de connexion
        const loginForm = document.getElementById('loginForm');
        
        // Éléments du dashboard
        const totalProductsEl = document.getElementById('totalProducts');
        const todayOrdersEl = document.getElementById('todayOrders');
        const totalRevenueEl = document.getElementById('totalRevenue');
        const totalUsersEl = document.getElementById('totalUsers');
        const recentProductsTable = document.getElementById('recentProductsTable');
        
        // Éléments de la page produits
        const allProductsTable = document.getElementById('allProductsTable');
        const showAddProductFormBtn = document.getElementById('showAddProductForm');
        const cancelProductFormBtn = document.getElementById('cancelProductForm');
        const productFormPage = document.getElementById('productFormPage');
        const productsPage = document.getElementById('productsPage');
        const productForm = document.getElementById('productForm');
        const productFormTitle = document.getElementById('productFormTitle');
        const cancelFormBtn = document.getElementById('cancelForm');
        const submitProductFormBtn = document.getElementById('submitProductForm');
        
        // Éléments du formulaire de produit
        const productIdInput = document.getElementById('productId');
        const productNameInput = document.getElementById('productName');
        const productCategoryInput = document.getElementById('productCategory');
        const productDescriptionInput = document.getElementById('productDescription');
        const productPriceInput = document.getElementById('productPrice');
        const productStockInput = document.getElementById('productStock');
        const productImageInput = document.getElementById('productImage');
        
        // Éléments de la page catégories
        const clothesCountEl = document.getElementById('clothesCount');
        const shoesCountEl = document.getElementById('shoesCount');
        const jewelryCountEl = document.getElementById('jewelryCount');
        const accessoriesCountEl = document.getElementById('accessoriesCount');
        
        // Éléments de navigation
        const adminMenuLinks = document.querySelectorAll('.admin-menu a[data-page]');
        const logoutBtn = document.getElementById('logoutBtn');
        
        // Fonction pour formater le prix
        function formatPrice(price) {
            return new Intl.NumberFormat('fr-HT', {
                style: 'currency',
                currency: 'HTG',
                minimumFractionDigits: 0
            }).format(price);
        }
        
        // Fonction pour afficher une notification
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            // Ajouter le style pour la notification
            const style = document.createElement('style');
            style.textContent = `
                .notification {
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    padding: 15px 20px;
                    border-radius: 8px;
                    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
                    z-index: 3000;
                    animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s;
                    animation-fill-mode: forwards;
                    color: white;
                }
                
                .notification.success {
                    background-color: #2ecc71;
                }
                
                .notification.error {
                    background-color: #e74c3c;
                }
                
                @keyframes slideIn {
                    from {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
                
                @keyframes fadeOut {
                    from {
                        opacity: 1;
                    }
                    to {
                        opacity: 0;
                    }
                }
            `;
            
            document.head.appendChild(style);
            document.body.appendChild(notification);
            
            // Supprimer la notification après 3 secondes
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                    document.head.removeChild(style);
                }
            }, 3000);
        }
        
        // Fonction pour charger les produits depuis l'API
        async function loadAdminProducts() {
            try {
                // Essayer de récupérer les produits depuis l'API
                const API_URL = "https://es-company-api.onrender.com";
                const response = await fetch(`${API_URL}/api/products`);
                
                if (response.ok) {
                    adminProducts = await response.json();
                } else {
                    // Si l'API n'est pas disponible, utiliser les produits par défaut
                    console.log("API non disponible, utilisation des produits par défaut");
                    adminProducts = [
                        {
                            id: 1,
                            name: "Robe Élégante",
                            description: "Robe longue en soie pour occasions spéciales",
                            price: 4500,
                            category: "Vêtements",
                            image: "https://images.unsplash.com/photo-1595777457583-95e059d581b8?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                            stock: 15
                        },
                        {
                            id: 2,
                            name: "Pantalon Chic",
                            description: "Pantalon en lin pour un style décontracté mais élégant",
                            price: 3200,
                            category: "Vêtements",
                            image: "https://images.unsplash.com/photo-1594633312681-425c7b97ccd1?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                            stock: 20
                        },
                        {
                            id: 3,
                            name: "Jupe Florale",
                            description: "Jupe mi-longue avec motif floral printanier",
                            price: 2800,
                            category: "Vêtements",
                            image: "https://images.unsplash.com/photo-1583496661160-fb5886a0aaaa?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                            stock: 12
                        },
                        {
                            id: 4,
                            name: "Baskets Modernes",
                            description: "Chaussures de sport confortables et stylées",
                            price: 5500,
                            category: "Chaussures",
                            image: "https://images.unsplash.com/photo-1549298916-b41d501d3772?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                            stock: 8
                        }
                    ];
                }
                
                // Mettre à jour l'interface
                updateDashboard();
                updateProductsTable();
                updateCategoriesCount();
                
            } catch (error) {
                console.error("Erreur lors du chargement des produits:", error);
                showNotification("Erreur lors du chargement des produits", "error");
            }
        }
        
        // Fonction pour mettre à jour le dashboard
        function updateDashboard() {
            // Mettre à jour les statistiques
            totalProductsEl.textContent = adminProducts.length;
            
            // Compter les produits par catégorie pour les récents
            const recentProducts = adminProducts.slice(0, 5);
            
            // Mettre à jour la table des produits récents
            recentProductsTable.innerHTML = '';
            
            if (recentProducts.length === 0) {
                recentProductsTable.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 30px; color: var(--gray-color);">
                            Aucun produit pour le moment
                        </td>
                    </tr>
                `;
                return;
            }
            
            recentProducts.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><img src="${product.image || 'https://images.unsplash.com/photo-1567401893414-76b7b1e5a7a5?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'}" alt="${product.name}"></td>
                    <td>${product.name}</td>
                    <td>${product.category || 'Non catégorisé'}</td>
                    <td>${formatPrice(product.price)}</td>
                    <td class="actions">
                        <button class="edit-btn" data-id="${product.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="delete-btn" data-id="${product.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                recentProductsTable.appendChild(row);
            });
            
            // Ajouter les écouteurs d'événements aux boutons d'actions
            document.querySelectorAll('#recentProductsTable .edit-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = parseInt(e.target.closest('.edit-btn').dataset.id);
                    editProduct(productId);
                });
            });
            
            document.querySelectorAll('#recentProductsTable .delete-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = parseInt(e.target.closest('.delete-btn').dataset.id);
                    deleteProduct(productId);
                });
            });
        }
        
        // Fonction pour mettre à jour la table des produits
        function updateProductsTable() {
            allProductsTable.innerHTML = '';
            
            if (adminProducts.length === 0) {
                allProductsTable.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 30px; color: var(--gray-color);">
                            Aucun produit pour le moment. Cliquez sur "Ajouter un produit" pour commencer.
                        </td>
                    </tr>
                `;
                return;
            }
            
            adminProducts.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><img src="${product.image || 'https://images.unsplash.com/photo-1567401893414-76b7b1e5a7a5?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'}" alt="${product.name}"></td>
                    <td>${product.name}</td>
                    <td>${product.category || 'Non catégorisé'}</td>
                    <td>${formatPrice(product.price)}</td>
                    <td class="actions">
                        <button class="edit-btn" data-id="${product.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="delete-btn" data-id="${product.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                allProductsTable.appendChild(row);
            });
            
            // Ajouter les écouteurs d'événements aux boutons d'actions
            document.querySelectorAll('#allProductsTable .edit-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = parseInt(e.target.closest('.edit-btn').dataset.id);
                    editProduct(productId);
                });
            });
            
            document.querySelectorAll('#allProductsTable .delete-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = parseInt(e.target.closest('.delete-btn').dataset.id);
                    deleteProduct(productId);
                });
            });
        }
        
        // Fonction pour mettre à jour le compteur des catégories
        function updateCategoriesCount() {
            const clothesCount = adminProducts.filter(p => p.category === 'Vêtements').length;
            const shoesCount = adminProducts.filter(p => p.category === 'Chaussures').length;
            const jewelryCount = adminProducts.filter(p => p.category === 'Bijoux').length;
            const accessoriesCount = adminProducts.filter(p => p.category === 'Accessoires').length;
            
            clothesCountEl.textContent = clothesCount;
            shoesCountEl.textContent = shoesCount;
            jewelryCountEl.textContent = jewelryCount;
            accessoriesCountEl.textContent = accessoriesCount;
        }
        
        // Fonction pour éditer un produit
        function editProduct(productId) {
            const product = adminProducts.find(p => p.id === productId);
            
            if (!product) return;
            
            // Remplir le formulaire avec les données du produit
            productIdInput.value = product.id;
            productNameInput.value = product.name;
            productCategoryInput.value = product.category || '';
            productDescriptionInput.value = product.description || '';
            productPriceInput.value = product.price;
            productStockInput.value = product.stock || 10;
            productImageInput.value = product.image || '';
            
            // Changer le titre du formulaire
            productFormTitle.textContent = 'Modifier le produit';
            
            // Afficher le formulaire
            showPage('productFormPage');
            
            // Stocker l'ID du produit en cours d'édition
            editingProductId = productId;
        }
        
        // Fonction pour supprimer un produit
        function deleteProduct(productId) {
            if (!confirm('Êtes-vous sûr de vouloir supprimer ce produit ?')) {
                return;
            }
            
            // Supprimer le produit du tableau
            adminProducts = adminProducts.filter(p => p.id !== productId);
            
            // Mettre à jour l'interface
            updateDashboard();
            updateProductsTable();
            updateCategoriesCount();
            
            showNotification('Produit supprimé avec succès');
            
            // Ici, normalement, on enverrait une requête DELETE à l'API
            console.log(`Produit ${productId} supprimé (simulation)`);
        }
        
        // Fonction pour afficher une page spécifique
        function showPage(pageId) {
            // Cacher toutes les pages
            adminPages.forEach(page => {
                page.style.display = 'none';
            });
            
            // Afficher la page demandée
            document.getElementById(pageId).style.display = 'block';
            
            // Mettre à jour le menu actif
            adminMenuLinks.forEach(link => {
                if (link.dataset.page === pageId.replace('Page', '')) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
        }
        
        // Initialisation de l'admin panel
        document.addEventListener('DOMContentLoaded', () => {
            // Mettre à jour la date actuelle
            const currentDate = new Date().toLocaleDateString('fr-FR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('currentDate').textContent = currentDate;
            
            // Événement pour le formulaire de connexion
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                // Vérification simple (en production, il faudrait une vraie authentification)
                if (username === 'admin' && password === 'admin123') {
                    // Afficher le panel admin
                    loginPage.style.display = 'none';
                    adminPanel.style.display = 'flex';
                    
                    // Charger les produits
                    loadAdminProducts();
                    
                    // Afficher le dashboard par défaut
                    showPage('dashboardPage');
                    
                    showNotification('Connexion réussie!');
                } else {
                    showNotification('Nom d\'utilisateur ou mot de passe incorrect', 'error');
                }
            });
            
            // Événements pour la navigation
            adminMenuLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.dataset.page;
                    showPage(`${page}Page`);
                });
            });
            
            // Événement pour le bouton de déconnexion
            logoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                
                if (confirm('Êtes-vous sûr de vouloir vous déconnecter ?')) {
                    // Revenir à la page de connexion
                    adminPanel.style.display = 'none';
                    loginPage.style.display = 'flex';
                    
                    // Réinitialiser le formulaire de connexion
                    loginForm.reset();
                    
                    showNotification('Déconnexion réussie');
                }
            });
            
            // Événements pour la gestion des produits
            showAddProductFormBtn.addEventListener('click', () => {
                // Réinitialiser le formulaire
                productForm.reset();
                productIdInput.value = '';
                productFormTitle.textContent = 'Ajouter un produit';
                editingProductId = null;
                
                // Afficher le formulaire
                showPage('productFormPage');
            });
            
            cancelProductFormBtn.addEventListener('click', () => {
                // Revenir à la page des produits
                showPage('productsPage');
            });
            
            cancelFormBtn.addEventListener('click', () => {
                // Revenir à la page des produits
                showPage('productsPage');
            });
            
            // Événement pour le formulaire de produit
            productForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Récupérer les valeurs du formulaire
                const productData = {
                    name: productNameInput.value,
                    category: productCategoryInput.value,
                    description: productDescriptionInput.value,
                    price: parseFloat(productPriceInput.value),
                    stock: parseInt(productStockInput.value) || 10,
                    image: productImageInput.value
                };
                
                // Validation simple
                if (!productData.name || !productData.category || !productData.price || !productData.image) {
                    showNotification('Veuillez remplir tous les champs obligatoires', 'error');
                    return;
                }
                
                try {
                    // Si on est en mode édition
                    if (editingProductId) {
                        // Mettre à jour le produit existant
                        const index = adminProducts.findIndex(p => p.id === editingProductId);
                        if (index !== -1) {
                            adminProducts[index] = {
                                ...adminProducts[index],
                                ...productData
                            };
                        }
                        
                        showNotification('Produit modifié avec succès');
                    } else {
                        // Ajouter un nouveau produit
                        const newId = adminProducts.length > 0 ? Math.max(...adminProducts.map(p => p.id)) + 1 : 1;
                        
                        adminProducts.push({
                            id: newId,
                            ...productData
                        });
                        
                        showNotification('Produit ajouté avec succès');
                    }
                    
                    // Ici, normalement, on enverrait une requête POST/PUT à l'API
                    console.log('Produit enregistré (simulation):', productData);
                    
                    // Revenir à la page des produits
                    showPage('productsPage');
                    
                    // Mettre à jour l'interface
                    updateDashboard();
                    updateProductsTable();
                    updateCategoriesCount();
                    
                } catch (error) {
                    console.error('Erreur lors de l\'enregistrement du produit:', error);
                    showNotification('Erreur lors de l\'enregistrement du produit', 'error');
                }
            });
            
            // Événement pour le formulaire des paramètres
            const settingsForm = document.getElementById('settingsForm');
            if (settingsForm) {
                settingsForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    showNotification('Paramètres enregistrés avec succès');
                });
            }
        });
    </script>
</body>
</html>
